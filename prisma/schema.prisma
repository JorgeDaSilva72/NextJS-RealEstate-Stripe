// // This is your Prisma schema file,
// // learn more about it in the docs: https://pris.ly/d/prisma-schema

// generator client {
//   provider = "prisma-client-js"
// }
// //Developement

// // datasource db {
// //   provider = "sqlite"
// //   url      = env("DATABASE_URL")
// // }

// // PRODUCTION avec Postgres DB IN VERCEL 
// // datasource db {
// //   provider = "postgresql"
// //   url = env("POSTGRES_PRISMA_URL") // uses connection pooling
// //   directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
// // }
// // PRODUCTION avec Postgres DB IN NEON

// datasource db {
//   provider  = "postgresql"
//   url  	    = env("DATABASE_URL")
//   //uncomment next line if you use Prisma <5.10
//   // directUrl = env("DATABASE_URL_UNPOOLED")
// }

// model User {
//   id            String          @id
//   firstName     String
//   lastName      String
//   email         String
//   avatarUrl     String?
//   createdAt     DateTime        @default(now())
//   Property      Property[]
//   subscriptions Subscriptions[]

//   // Relation avec les rendez-vous
//   appointments  Appointment[]

// }

// model Property {
//   id          Int               @id @default(autoincrement())
//   name        String
//   description String
//   price       Int
//   userId      String
//   user        User              @relation(fields: [userId], references: [id])
//   typeId      Int
//   type        PropertyType      @relation(fields: [typeId], references: [id])
//   statusId    Int
//   status      PropertyStatus    @relation(fields: [statusId], references: [id])
//   location    PropertyLocation?
//   feature     PropertyFeature?
//   images      PropertyImage[]
//   videos      PropertyVideo[]   // Nouvelle relation pour les vid√©os
//   contact     Contact?
//   createdAt   DateTime @default(now()) // Nouvelle colonne

//   // Relation avec les rendez-vous
//   appointments Appointment[]
// }

// model Appointment {
//   id          Int       @id @default(autoincrement())
//   start       DateTime  // Heure de d√©but du rendez-vous
//   end         DateTime  // Heure de fin du rendez-vous
//   title       String    @default("Visite de l'immobilier")// Optionnel : Description du rendez-vous
//   createdAt   DateTime  @default(now())
//   state       String    @default("pending")

//   // Relation avec User
//   userId      String
//   user        User      @relation(fields: [userId], references: [id])

//   // Relation avec Property
//   propertyId  Int
//   property    Property   @relation(fields: [propertyId], references: [id])
// }

// model PropertyType {
//   id       Int        @id @default(autoincrement())
//   value    String @unique
//   Property Property[]
// }

// model PropertyStatus {
//   id       Int        @id @default(autoincrement())
//   value    String @unique
//   Property Property[]
// }

// model PropertyLocation {
//   id            Int      @id @default(autoincrement())
//   streetAddress String
//   city          String
//   state         String
//   zip           String
//   region        String
//   landmark      String
//   propertyId    Int      @unique
//   property      Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
// }

// model PropertyFeature {
//   id              Int      @id @default(autoincrement())
//   bedrooms        Int
//   bathrooms       Int
//   parkingSpots    Int
//   area            Int
//   hasSwimmingPool Boolean
//   hasGardenYard   Boolean
//   hasBalcony      Boolean
//   property        Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId      Int      @unique
// }

// model PropertyImage {
//   id         Int      @id @default(autoincrement())
//   url        String
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId Int
// }

// model PropertyVideo {
//   id          Int      @id @default(autoincrement())
//   url         String   // Lien YouTube de la vid√©o
//   propertyId  Int      // R√©f√©rence √† la propri√©t√© associ√©e
//   property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   createdAt   DateTime @default(now()) // Date d'ajout
// }

// model Contact {
//   id         Int      @id @default(autoincrement())
//   name       String
//   phone      String
//   email      String
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId Int      @unique
// }

// model SubscriptionPlan {
//   id                    Int             @id @default(autoincrement())
//   namePlan              String
//   price                 Float // Prix en euros
//   duration           String   @default("AN")// Dur√©e, ex: "AN" ou"Mois"
//   country            String   // Pays concern√©
//   startDate          DateTime // Date de d√©but
//   endDate            DateTime // Date de fin
//   premiumAds         Int      // Nombre d'annonces premium incluses
//   photosPerAd        Int      // Nombre de photos par annonce
//   shortVideosPerAd   Int      // Nombre de vid√©os courtes par annonce
//   youtubeVideoDuration String // Dur√©e des vid√©os YouTube
//   zoneRadius         Int      // Zone de couverture (en km)
//   features              String
//   createdAt          DateTime @default(now()) // Date de cr√©ation du plan
//   updatedAt          DateTime @updatedAt // Derni√®re mise √† jour
//   subscriptions         Subscriptions[]
// }

// model Subscriptions {
//   id        Int              @id @default(autoincrement())
//   paymentID String
//   createdAt DateTime         @default(now())
//   updatedAt DateTime         @updatedAt
//   startDate DateTime
//   endDate DateTime
//   plan      SubscriptionPlan @relation(fields: [palnId], references: [id])
//   palnId    Int
//   userId    String
//   user      User             @relation(fields: [userId], references: [id])
// }

// ---------------------------------------------------------------
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// modification branche feature/multilingual-countries
//generator client {
//  provider = "prisma-client-js"
// }

//Developement

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// model User {
//   id            String          @id
//   firstName     String
//   lastName      String
//   email         String
//   avatarUrl     String?
//   createdAt     DateTime        @default(now())
//   Property      Property[]
//   subscriptions Subscriptions[]
//   appointments  Appointment[]
// }

// model Property {
//   id          Int            @id @default(autoincrement())
//   name        String
//   description String
//   price       Int
//   userId      String
//   user        User           @relation(fields: [userId], references: [id])
//   typeId      Int
//   type        PropertyType   @relation(fields: [typeId], references: [id])
//   statusId    Int
//   status      PropertyStatus @relation(fields: [statusId], references: [id])

//   // Relation avec le pays
//   countryId Int?
//   country   Country? @relation(fields: [countryId], references: [id])

//   location     PropertyLocation?
//   feature      PropertyFeature?
//   images       PropertyImage[]
//   videos       PropertyVideo[]
//   contact      Contact?
//   createdAt    DateTime          @default(now())
//   appointments Appointment[]
// }

// model Appointment {
//   id         Int      @id @default(autoincrement())
//   start      DateTime
//   end        DateTime
//   title      String   @default("Visite de l'immobilier")
//   createdAt  DateTime @default(now())
//   state      String   @default("pending")
//   userId     String
//   user       User     @relation(fields: [userId], references: [id])
//   propertyId Int
//   property   Property @relation(fields: [propertyId], references: [id])
// }

// // ============================================
// // SYST√àME MULTILINGUE - TABLES PRINCIPALES
// // ============================================

// model Language {
//   id        Int      @id @default(autoincrement())
//   code      String   @unique // "fr", "en", "ar", etc.
//   name      String // "Fran√ßais", "English", "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"
//   isActive  Boolean  @default(true)
//   isDefault Boolean  @default(false) // Langue par d√©faut du site
//   createdAt DateTime @default(now())

//   // Relations avec les traductions
//   countryTranslations        CountryTranslation[]
//   regionTranslations         RegionTranslation[]
//   cityTranslations           CityTranslation[]
//   propertyTypeTranslations   PropertyTypeTranslation[]
//   propertyStatusTranslations PropertyStatusTranslation[]
// }

// // ============================================
// // GESTION DES PAYS AFRICAINS
// // ============================================

// model Country {
//   id             Int      @id @default(autoincrement())
//   code           String   @unique // Code ISO (ex: "SN", "CI", "MA")
//   phonePrefix    String // Pr√©fixe t√©l√©phonique (ex: "+221")
//   currency       String // Devise (ex: "XOF", "MAD")
//   currencySymbol String // Symbole (ex: "FCFA", "DH")
//   flagEmoji      String? // Emoji du drapeau (ex: "üá∏üá≥")
//   latitude       Float? // Centre g√©ographique du pays
//   longitude      Float?
//   isActive       Boolean  @default(true)
//   displayOrder   Int      @default(0) // Ordre d'affichage
//   createdAt      DateTime @default(now())
//   updatedAt      DateTime @updatedAt

//   // Relations
//   translations      CountryTranslation[]
//   regions           Region[]
//   cities            City[]
//   properties        Property[]
//   subscriptionPlans SubscriptionPlan[]
// }

// model CountryTranslation {
//   id          Int      @id @default(autoincrement())
//   countryId   Int
//   country     Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
//   languageId  Int
//   language    Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
//   name        String // Nom traduit (ex: "S√©n√©gal" / "Senegal")
//   description String? // Description optionnelle du pays

//   @@unique([countryId, languageId]) // Une seule traduction par langue
//   @@index([languageId])
// }

// // ============================================
// // GESTION DES R√âGIONS
// // ============================================

// model Region {
//   id        Int      @id @default(autoincrement())
//   countryId Int
//   country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
//   code      String? // Code de la r√©gion (optionnel)
//   latitude  Float?
//   longitude Float?
//   isActive  Boolean  @default(true)
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   // Relations
//   translations RegionTranslation[]
//   cities       City[]

//   @@index([countryId])
// }

// model RegionTranslation {
//   id         Int      @id @default(autoincrement())
//   regionId   Int
//   region     Region   @relation(fields: [regionId], references: [id], onDelete: Cascade)
//   languageId Int
//   language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
//   name       String // Nom traduit de la r√©gion

//   @@unique([regionId, languageId])
//   @@index([languageId])
// }

// // ============================================
// // GESTION DES VILLES
// // ============================================

// model City {
//   id         Int      @id @default(autoincrement())
//   regionId   Int?
//   region     Region?  @relation(fields: [regionId], references: [id], onDelete: SetNull)
//   countryId  Int
//   country    Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
//   code       String? // Code postal ou code ville
//   latitude   Float?
//   longitude  Float?
//   population Int? // Population (optionnel)
//   isActive   Boolean  @default(true)
//   isFeatured Boolean  @default(false) // Pour mettre en avant certaines villes
//   createdAt  DateTime @default(now())
//   updatedAt  DateTime @updatedAt

//   // Relations
//   translations      CityTranslation[]
//   propertyLocations PropertyLocation[]

//   @@index([countryId])
//   @@index([regionId])
// }

// model CityTranslation {
//   id         Int      @id @default(autoincrement())
//   cityId     Int
//   city       City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
//   languageId Int
//   language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
//   name       String // Nom traduit de la ville

//   @@unique([cityId, languageId])
//   @@index([languageId])
// }

// // ============================================
// // MOD√àLES EXISTANTS AVEC MULTILINGUE
// // ============================================

// model PropertyType {
//   id           Int     @id @default(autoincrement())
//   code         String?  // Code technique (ex: "apartment", "house")
//   isActive     Boolean @default(true)
//   displayOrder Int     @default(0)

//   // Relations
//   translations PropertyTypeTranslation[]
//   properties   Property[]
// }

// model PropertyTypeTranslation {
//   id             Int          @id @default(autoincrement())
//   propertyTypeId Int
//   propertyType   PropertyType @relation(fields: [propertyTypeId], references: [id], onDelete: Cascade)
//   languageId     Int
//   language       Language     @relation(fields: [languageId], references: [id], onDelete: Cascade)
//   value          String // Traduction (ex: "Appartement" / "Apartment")
//   description    String? // Description optionnelle

//   @@unique([propertyTypeId, languageId])
//   @@index([languageId])
// }

// model PropertyStatus {
//   id           Int     @id @default(autoincrement())
//   code         String? // Code technique (ex: "for_sale", "for_rent")
//   isActive     Boolean @default(true)
//   displayOrder Int     @default(0)

//   // Relations
//   translations PropertyStatusTranslation[]
//   properties   Property[]
// }

// model PropertyStatusTranslation {
//   id               Int            @id @default(autoincrement())
//   propertyStatusId Int
//   propertyStatus   PropertyStatus @relation(fields: [propertyStatusId], references: [id], onDelete: Cascade)
//   languageId       Int
//   language         Language       @relation(fields: [languageId], references: [id], onDelete: Cascade)
//   value            String // Traduction (ex: "√Ä vendre" / "For Sale")
//   description      String?

//   @@unique([propertyStatusId, languageId])
//   @@index([languageId])
// }

// // ============================================
// // AUTRES MOD√àLES
// // ============================================

// model PropertyLocation {
//   id            Int    @id @default(autoincrement())
//   streetAddress String
//   country String?

//   // Nouvelle relation avec City
//   cityId Int?
//   city   City? @relation(fields: [cityId], references: [id], onDelete: SetNull)

//   // Champs conserv√©s pour compatibilit√© et d√©tails
//   neighborhood String? // Quartier
//   zip          String?
//   landmark     String? // Point de rep√®re

//   // Coordonn√©es GPS pr√©cises de la propri√©t√©
//   latitude  Float?
//   longitude Float?

//   propertyId Int      @unique
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

//   @@index([cityId])
// }

// model PropertyFeature {
//   id              Int      @id @default(autoincrement())
//   bedrooms        Int
//   bathrooms       Int
//   parkingSpots    Int
//   area            Int
//   hasSwimmingPool Boolean
//   hasGardenYard   Boolean
//   hasBalcony      Boolean
//   property        Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId      Int      @unique
// }

// model PropertyImage {
//   id         Int      @id @default(autoincrement())
//   url        String
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId Int
// }

// model PropertyVideo {
//   id         Int      @id @default(autoincrement())
//   url        String
//   propertyId Int
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   createdAt  DateTime @default(now())
// }

// model Contact {
//   id         Int      @id @default(autoincrement())
//   name       String
//   phone      String
//   email      String
//   property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
//   propertyId Int      @unique
// }

// model SubscriptionPlan {
//   id       Int    @id @default(autoincrement())
//   namePlan String
//   price    Float
//   duration String @default("AN")

//   // Relation avec le pays
//   countryId Int?
//   country   Country? @relation(fields: [countryId], references: [id])

//   startDate            DateTime
//   endDate              DateTime
//   premiumAds           Int
//   photosPerAd          Int
//   shortVideosPerAd     Int
//   youtubeVideoDuration String
//   zoneRadius           Int
//   features             String
//   createdAt            DateTime        @default(now())
//   updatedAt            DateTime        @updatedAt
//   subscriptions        Subscriptions[]
// }

// model Subscriptions {
//   id        Int              @id @default(autoincrement())
//   paymentID String
//   createdAt DateTime         @default(now())
//   updatedAt DateTime         @updatedAt
//   startDate DateTime
//   endDate   DateTime
//   plan      SubscriptionPlan @relation(fields: [planId], references: [id])
//   planId    Int
//   userId    String
//   user      User             @relation(fields: [userId], references: [id])
// }

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  //uncomment next line if you use Prisma <5.10
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id            String          @id
  firstname     String?
  lastname      String?
  email         String          @unique // AJOUT: index unique pour performances
  avatarUrl     String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt // AJOUT: tracking des modifications
  Property      Property[]
  subscriptions Subscriptions[]
  appointments  Appointment[]
  
  // Google Analytics OAuth tokens
  googleAnalyticsToken GoogleAnalyticsToken?

  // WhatsApp Relations
  whatsappConversations     WhatsAppConversation[]
  assignedWhatsappConversations WhatsAppConversation[] @relation("AssignedConversations")

  @@index([email]) // AJOUT: index pour recherche rapide
  @@index([createdAt]) // AJOUT: pour trier par date
}

model Property {
  id          Int    @id @default(autoincrement())
  name        Json
  description Json 
  price       Int
  currency    String @default("XOF") // AJOUT: devise de l'annonce

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade) // AJOUT: Cascade

  typeId Int
  type   PropertyType @relation(fields: [typeId], references: [id])

  statusId Int
  status   PropertyStatus @relation(fields: [statusId], references: [id])

  countryId Int? // CHANGEMENT: devrait √™tre obligatoire
  country   Country? @relation(fields: [countryId], references: [id])

  // AJOUT: Champs de performance
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false) // Pour les annonces premium
  viewCount  Int     @default(0) // Compteur de vues

  location PropertyLocation?
  feature  PropertyFeature?
  images   PropertyImage[]
  videos   PropertyVideo[]
  contact  Contact?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt // AJOUT
  publishedAt DateTime? // AJOUT: date de publication
  expiresAt   DateTime? // AJOUT: date d'expiration

 

  // Relation avec les rendez-vous
  appointments Appointment[]
  
  // WhatsApp Relations
  whatsappConversations WhatsAppConversation[]
  
  // AJOUT: Indexes pour performances
  @@index([userId])
  @@index([typeId])
  @@index([statusId])
  @@index([countryId])
  @@index([isActive, isFeatured]) // Recherche des annonces actives/premium
  @@index([createdAt(sort: Desc)]) // Tri par date d√©croissante
  @@index([price]) // Recherche par prix

  
}


enum AppointmentState {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELED
}

model Appointment {
  id        Int      @id @default(autoincrement())
  start     DateTime
  end       DateTime
  title     String   @default("Visite de l'immobilier")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // AJOUT
  state AppointmentState @default(PENDING) // Changement : String -> AppointmentState

// Relation avec User
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade) // AJOUT: Cascade

// Relation avec Property
  propertyId Int
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade) // AJOUT: Cascade

  // AJOUT: Indexes
  @@index([userId])
  @@index([propertyId])
  @@index([start])
  @@index([state])
}

// ============================================
// SYST√àME MULTILINGUE - TABLES PRINCIPALES
// ============================================

model Language {
  id        Int      @id @default(autoincrement())
  code      String   @unique // "fr", "en",  etc.
  name      String
  isActive  Boolean  @default(true)
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations avec les traductions

  countryTranslations        CountryTranslation[]
  regionTranslations         RegionTranslation[]
  cityTranslations           CityTranslation[]
  propertyTypeTranslations   PropertyTypeTranslation[]
  propertyStatusTranslations PropertyStatusTranslation[]
}

// ============================================
// GESTION DES PAYS AFRICAINS
// ============================================

model Country {
  id             Int      @id @default(autoincrement())
  code           String   @unique // Code ISO (ex: "SN", "CI", "MA")
  phonePrefix    String   // Pr√©fixe t√©l√©phonique (ex: "+221")
  currency       String   // Devise (ex: "XOF", "MAD")
  currencySymbol String   // Symbole (ex: "FCFA", "DH")
  flagEmoji      String?  // Emoji du drapeau (ex: "üá∏üá≥")
  latitude       Decimal?   // Centre g√©ographique du pays
  longitude      Decimal?
  isActive       Boolean  @default(true)
  displayOrder   Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations

  translations      CountryTranslation[]
  regions           Region[]
  cities            City[]
  properties        Property[]
  subscriptionPlans SubscriptionPlan[]

  @@index([isActive, displayOrder]) // AJOUT
}

model CountryTranslation {
  id          Int      @id @default(autoincrement())
  countryId   Int
  country     Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  languageId  Int
  language    Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  name        String   // Nom traduit (ex: "S√©n√©gal" / "Senegal")
  description String?  @db.Text // CHANGEMENT

  @@unique([countryId, languageId])
  @@index([languageId])
}

// ============================================
// GESTION DES R√âGIONS
// ============================================

model Region {
  id        Int      @id @default(autoincrement())
  countryId Int
  country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  code      String?  // Code de la r√©gion (optionnel)
  latitude  Decimal?
  longitude Decimal?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations

  translations RegionTranslation[]
  cities       City[]

  @@index([countryId])
  @@index([isActive]) // AJOUT
}

model RegionTranslation {
  id         Int      @id @default(autoincrement())
  regionId   Int
  region     Region   @relation(fields: [regionId], references: [id], onDelete: Cascade)
  languageId Int
  language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  name       String   // Nom traduit de la r√©gion

  @@unique([regionId, languageId])
  @@index([languageId])
}

// ============================================
// GESTION DES VILLES
// ============================================

model City {
  id         Int      @id @default(autoincrement())
  regionId   Int?
  region     Region?  @relation(fields: [regionId], references: [id], onDelete: SetNull)
  countryId  Int
  country    Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  code       String?  // Code postal ou code ville
  latitude   Decimal?
  longitude  Decimal?
  population Int?     // Population (optionnel)
  isActive   Boolean  @default(true)
  isFeatured Boolean  @default(false) // Pour mettre en avant certaines villes
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt


  // Relations
  translations      CityTranslation[]
  propertyLocations PropertyLocation[]

  @@index([countryId])
  @@index([regionId])
  @@index([isActive, isFeatured]) // AJOUT
}

model CityTranslation {
  id         Int      @id @default(autoincrement())
  cityId     Int
  city       City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  languageId Int
  language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  name       String // Nom traduit de la ville

  @@unique([cityId, languageId])
  @@index([languageId])
  @@index([name]) // AJOUT: recherche par nom de ville
  @@index([languageId, name]) // AJOUT: Optimisation de la recherche par langue
}

// ============================================
// MOD√àLES EXISTANTS AVEC MULTILINGUE
// ============================================

model PropertyType {
  id           Int     @id @default(autoincrement())
  code         String  @unique // CHANGEMENT: devrait √™tre obligatoire et unique // Code technique (ex: "apartment", "house")
  isActive     Boolean @default(true)
  displayOrder Int     @default(0)


  // Relations
  translations PropertyTypeTranslation[]
  properties   Property[]

  @@index([isActive, displayOrder]) // AJOUT
}

model PropertyTypeTranslation {
  id             Int          @id @default(autoincrement())
  propertyTypeId Int
  propertyType   PropertyType @relation(fields: [propertyTypeId], references: [id], onDelete: Cascade)
  languageId     Int
  language       Language     @relation(fields: [languageId], references: [id], onDelete: Cascade)
  value          String       // Traduction (ex: "Appartement" / "Apartment")
  description    String?      @db.Text // CHANGEMENT // Description optionnelle

  @@unique([propertyTypeId, languageId])
  @@index([languageId])
}

model PropertyStatus {
  id           Int     @id @default(autoincrement())
  code         String  @unique // CHANGEMENT: devrait √™tre obligatoire et unique Code technique (ex: "for_sale", "for_rent")
  isActive     Boolean @default(true)
  displayOrder Int     @default(0)

  // Relations
  translations PropertyStatusTranslation[]
  properties   Property[]

  @@index([isActive, displayOrder]) // AJOUT
}

model PropertyStatusTranslation {
  id               Int            @id @default(autoincrement())
  propertyStatusId Int
  propertyStatus   PropertyStatus @relation(fields: [propertyStatusId], references: [id], onDelete: Cascade)
  languageId       Int
  language         Language       @relation(fields: [languageId], references: [id], onDelete: Cascade)
  value            String         // Traduction (ex: "√Ä vendre" / "For Sale")
  description      String?        @db.Text // CHANGEMENT

  @@unique([propertyStatusId, languageId])
  @@index([languageId])
}

// ============================================
// AUTRES MOD√àLES
// ============================================

model PropertyLocation {
  id            Int     @id @default(autoincrement())
  streetAddress String
  country       String? // SUGGESTION: retirer ce champ, redondant avec Country

  // Nouvelle relation avec City
  cityId Int?
  city   City? @relation(fields: [cityId], references: [id], onDelete: SetNull)

  // Champs conserv√©s pour compatibilit√© et d√©tails
  neighborhood String?
  zip          String?
  landmark     Json?

  // Coordonn√©es GPS pr√©cises de la propri√©t√©
  latitude  Decimal?
  longitude Decimal?

  propertyId Int      @unique
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([cityId])
  @@index([latitude, longitude]) // AJOUT: recherche g√©ographique
}

model PropertyFeature {
  id              Int     @id @default(autoincrement())
  bedrooms        Int
  bathrooms       Int
  parkingSpots    Int
  area            Int // SUGGESTION: ajouter unit√© (m2, ft2)
  hasSwimmingPool Boolean
  hasGardenYard   Boolean
  hasBalcony      Boolean

  // AJOUT: Autres features utiles
  floor       Int? // √âtage
  totalFloors Int? // Nombre total d'√©tages
  yearBuilt   Int? // Ann√©e de construction

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId Int      @unique

  // AJOUT: Indexes pour recherche avanc√©e
  @@index([bedrooms])
  @@index([area])
}

model PropertyImage {
  id           Int     @id @default(autoincrement())
  url          String
  caption      String? // AJOUT: l√©gende de l'image
  displayOrder Int     @default(0) // AJOUT: ordre d'affichage
  isMain       Boolean @default(false) // AJOUT: image principale

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId Int

  createdAt DateTime @default(now()) // AJOUT

  @@index([propertyId])
  @@index([isMain]) // AJOUT
}

model PropertyVideo {
  id       Int     @id @default(autoincrement())
  url      String
  title    String? // AJOUT
  duration Int? // AJOUT: dur√©e en secondes

  propertyId Int
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([propertyId])
}

model Contact {
  id    Int    @id @default(autoincrement())
  name  String
  phone String
  email String

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId Int      @unique
}

model SubscriptionPlan {
  id       Int    @id @default(autoincrement())
  namePlan String
  price    Decimal // changement
  duration String @default("AN")


  // Relation avec le pays
  countryId Int?
  country   Country? @relation(fields: [countryId], references: [id])

  startDate            DateTime
  endDate              DateTime
  premiumAds           Int
  photosPerAd          Int
  shortVideosPerAd     Int
  youtubeVideoDuration String
  zoneRadius           Int
  features             String   @db.Text // CHANGEMENT

  isActive     Boolean @default(true) // AJOUT
  displayOrder Int     @default(0) // AJOUT

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subscriptions Subscriptions[]

  @@index([countryId])
  @@index([isActive, displayOrder]) // AJOUT
}

enum SubscriptionStatus {
  ACTIVE
  PAUSED
  CANCELED
  EXPIRED
  PENDING
}

model Subscriptions {
  id        Int    @id @default(autoincrement())
  paymentID String @unique // AJOUT: unique
  status SubscriptionStatus @default(ACTIVE) // Changement : String -> SubscriptionStatus
  paymentProvider String? // Primer, Stripe, PayPal, Flutterwave, Paystack
  
  // Multi-currency support
  baseAmount      Decimal? // Amount in base currency (EUR/USD)
  baseCurrency    String? // Base currency code (EUR or USD)
  paidAmount      Decimal? // Amount actually paid
  paidCurrency    String? // Currency code used for payment
  exchangeRate    Decimal? // Exchange rate at time of payment

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  startDate DateTime
  endDate   DateTime

  plan   SubscriptionPlan @relation(fields: [planId], references: [id])
  planId Int

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade) // AJOUT: Cascade

  @@index([userId])
  @@index([planId])
  @@index([endDate]) // AJOUT: pour v√©rifier les expirations
  @@index([status]) // AJOUT
  @@index([paymentProvider]) // AJOUT
 
}

model GoogleAnalyticsToken {
  id           Int      @id @default(autoincrement())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken  String // Encrypted access token
  refreshToken String // Encrypted refresh token
  expiryDate   DateTime // Token expiration date
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// ============================================
// WHATSAPP BUSINESS API INTEGRATION
// ============================================

model WhatsAppAccount {
  id                String    @id @default(cuid())
  phoneNumberId     String    @unique // WhatsApp Business Phone Number ID
  phoneNumber       String    // Display phone number
  businessAccountId String    // WhatsApp Business Account ID
  isActive          Boolean   @default(true)
  isVerified        Boolean   @default(false)
  webhookVerified   Boolean   @default(false)
  
  // API Configuration
  accessToken       String    @db.Text // Encrypted access token
  tokenExpiresAt    DateTime?
  
  // Metadata
  displayName       String?
  profilePictureUrl String?
  timezone          String    @default("UTC")
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  messages          WhatsAppMessage[]
  conversations     WhatsAppConversation[]
  templates         WhatsAppTemplate[]

  @@index([isActive])
  @@index([phoneNumberId])
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  BLOCKED
  SPAM
}

model WhatsAppConversation {
  id              String    @id @default(cuid())
  accountId       String
  account         WhatsAppAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  
  // Participant Information
  userPhone       String    // User's WhatsApp number
  userName        String?   // User's name from WhatsApp profile
  
  // Associated Records
  userId          String?
  user            User?     @relation(fields: [userId], references: [id])
  propertyId      Int?
  property        Property? @relation(fields: [propertyId], references: [id])
  
  // Conversation Status
  status          ConversationStatus @default(ACTIVE)
  lastMessageAt   DateTime  @default(now())
  unreadCount     Int       @default(0)
  
  // Assignment
  assignedToUserId String?  // Admin/Agent assigned
  assignedTo       User?    @relation("AssignedConversations", fields: [assignedToUserId], references: [id])
  
  // Metadata
  tags            String[]  // Tags for categorization
  notes           String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  messages        WhatsAppMessage[]
  
  @@index([accountId])
  @@index([userId])
  @@index([propertyId])
  @@index([status])
  @@index([lastMessageAt(sort: Desc)])
  @@index([userPhone])
}

enum MessageDirection {
  INBOUND
  OUTBOUND
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  DOCUMENT
  AUDIO
  LOCATION
  CONTACTS
  TEMPLATE
  INTERACTIVE
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
  DELETED
}

model WhatsAppMessage {
  id              String    @id @default(cuid())
  
  // WhatsApp IDs
  waMessageId     String    @unique // WhatsApp message ID
  accountId       String
  account         WhatsAppAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  
  conversationId  String
  conversation    WhatsAppConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  // Message Content
  direction       MessageDirection // INBOUND or OUTBOUND
  type            MessageType // TEXT, IMAGE, VIDEO, DOCUMENT, etc.
  content         Json      // Message content (text, media URLs, etc.)
  
  // Sender/Recipient
  fromPhone       String
  toPhone         String
  
  // Status Tracking
  status          MessageStatus @default(SENT)
  errorCode       String?
  errorMessage    String?
  
  // Timing
  sentAt          DateTime  @default(now())
  deliveredAt     DateTime?
  readAt          DateTime?
  
  // Template (if applicable)
  templateName    String?
  templateId      String?
  template        WhatsAppTemplate? @relation(fields: [templateId], references: [id])
  
  // Context (reply/forwarded)
  replyToId       String?
  context         Json?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([accountId])
  @@index([conversationId])
  @@index([waMessageId])
  @@index([direction])
  @@index([status])
  @@index([sentAt(sort: Desc)])
  @@index([fromPhone])
  @@index([toPhone])
}

enum TemplateCategory {
  MARKETING
  UTILITY
  AUTHENTICATION
}

enum TemplateStatus {
  PENDING
  APPROVED
  REJECTED
  DISABLED
}

model WhatsAppTemplate {
  id              String    @id @default(cuid())
  accountId       String
  account         WhatsAppAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  
  // Template Information
  name            String    // Template name
  category        TemplateCategory
  language        String    // Language code (e.g., "en", "fr", "ar")
  status          TemplateStatus @default(PENDING)
  
  // Template Content
  headerType      String?   // TEXT, IMAGE, VIDEO, DOCUMENT
  headerContent   String?   @db.Text
  bodyText        String    @db.Text
  footerText      String?
  
  // Template Variables
  variables       Json?     // Variable mappings
  
  // WhatsApp Template ID
  waTemplateId    String?   @unique
  
  // Usage Statistics
  sentCount       Int       @default(0)
  lastUsedAt      DateTime?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  messages        WhatsAppMessage[]
  
  @@unique([accountId, name, language])
  @@index([accountId])
  @@index([status])
  @@index([category])
}